/*! cta v1.0.0 | (c) 2014 Inbound Now | https://github.com/inboundnow/cta */
function setGlobalLeadVar(e){Lead_Globals=e}var inbound_data=inbound_data||{},_gaq=_gaq||[],InboundAnalytics=function(){var e=!1,t={init:function(){InboundAnalytics.Utils.init(),InboundAnalytics.PageTracking.StorePageView(),InboundAnalytics.Events.loadEvents()},debug:function(t,a){if(e&&console){var t=t||!1;t&&"string"==typeof t&&console.log(t),a&&a instanceof Function&&a()}}};return t}(),InboundTotalStorage=function(e){var t,a,n="inboundAnalytics";if("localStorage"in window)try{a="undefined"==typeof window.localStorage?void 0:window.localStorage,t="undefined"==typeof a||"undefined"==typeof window.JSON?!1:!0,window.localStorage.setItem(n,"1"),window.localStorage.removeItem(n)}catch(o){t=!1}e.totalStorage=function(t,a){return e.totalStorage.impl.init(t,a)},e.totalStorage.setItem=function(t,a){return e.totalStorage.impl.setItem(t,a)},e.totalStorage.getItem=function(t){return e.totalStorage.impl.getItem(t)},e.totalStorage.getAll=function(){return e.totalStorage.impl.getAll()},e.totalStorage.deleteItem=function(t){return e.totalStorage.impl.deleteItem(t)},e.totalStorage.impl={init:function(e,t){return"undefined"!=typeof t?this.setItem(e,t):this.getItem(e)},setItem:function(n,o){if(!t)try{return e.Utils.createCookie(n,o),o}catch(i){console.log("Local Storage not supported by this browser. Install the cookie plugin on your site to take advantage of the same functionality. You can get it at https://github.com/carhartl/jquery-cookie")}var l=JSON.stringify(o);return a.setItem(n,l),this.parseResult(l)},getItem:function(n){if(!t)try{return this.parseResult(e.Utils.readCookie(n))}catch(o){return null}var i=a.getItem(n);return this.parseResult(i)},deleteItem:function(n){if(!t)try{return e.Utils.eraseCookie(n,null),!0}catch(o){return!1}return a.removeItem(n),!0},getAll:function(){var n=[];if(t)for(var o in a)o.length&&n.push({key:o,value:this.parseResult(a.getItem(o))});else try{for(var i=document.cookie.split(";"),l=0;l<i.length;l++){var s=i[l].split("="),r=s[0];n.push({key:r,value:this.parseResult(e.Utils.readCookie(r))})}}catch(d){return null}return n},parseResult:function(e){var t;try{t=JSON.parse(e),"undefined"==typeof t&&(t=e),"true"==t&&(t=!0),"false"==t&&(t=!1),parseFloat(t)==t&&"object"!=typeof t&&(t=parseFloat(t))}catch(a){t=e}return t}}}(InboundAnalytics||{}),InboundAnalyticsLeadsAPI=function(e){var t;return e.LeadsAPI={init:function(){},storeLeadData:function(){element.addEventListener?element.addEventListener("submit",function(e){e.preventDefault(),window.history.back()},!0):element.attachEvent("onsubmit",function(e){e.preventDefault(),window.history.back()})},attachFormSubmitEvent:function(){for(var t=0;t<window.document.forms.length;t++){var a=window.document.forms[t],n="wpl-track-me";if("classList"in document.documentElement)var o=a.classList.contains(n);else var o=new RegExp("(^|\\s)"+n+"(\\s|$)").test(a.className);o&&(console.log("Has Class",o),e.Utils.addListener(a,"submit",e.LeadsAPI.formSubmit),console.log(a))}console.log("RAN attach event")},makeRequest:function(a){if(window.XMLHttpRequest)t=new XMLHttpRequest;else if(window.ActiveXObject)try{t=new ActiveXObject("Msxml2.XMLHTTP")}catch(n){try{t=new ActiveXObject("Microsoft.XMLHTTP")}catch(n){}}return t?(t.onreadystatechange=e.LeadsAPI.alertContents,t.open("GET",a),t.send(),void 0):(alert("Giving up :( Cannot create an XMLHTTP instance"),!1)},inbound_map_fields:function(e,t){var a=[],n=e,o=t,i=n.closest("label").text(),l=["credit-card"],s=jQuery.inArray(o,l);return 0==s?null:(a.push({field_label:i,field_name:n.attr("name"),field_value:n.attr("value"),field_id:n.attr("id"),field_class:n.attr("class"),field_type:n.attr("type"),match:o,js_selector:n.attr("data-js-selector")}),a)},run_field_map_function:function(t,a){for(var n,o=new Array,i=t,l=jQuery("body"),s=i.attr("id")||"NULL",r=i.attr("name")||"NULL",d=i.attr("value"),u=a.split(","),c=(u.length-1,0);c<u.length;c++){var _=e.Utils.trim(u[c]),f=_.replace(/^\s+|\s+$/g,""),f=f.replace(" ","_"),m=f in inbound_data;if(r.toLowerCase().indexOf(_)>-1){var p=e.LeadsAPI.inbound_map_fields(i,_,o);e.LeadsAPI.add_inbound_form_class(i,_),console.log("match name: "+_),console.log(f in inbound_data),m||(inbound_data[f]=d)}else if(s.toLowerCase().indexOf(_)>-1){var p=e.LeadsAPI.inbound_map_fields(i,_,o);e.LeadsAPI.add_inbound_form_class(i,_),console.log("match id: "+_),m||(inbound_data[f]=d)}else if(i.closest("li").children("label").length>0){var g=i.closest("li").children("label").html()||"NULL";if(g.toLowerCase().indexOf(_)>-1){var p=e.LeadsAPI.inbound_map_fields(i,_,o);e.LeadsAPI.add_inbound_form_class(i,_),console.log(i.context);var b=l.find("[data-inbound-form-map='inbound_map_"+f+"']").length;console.log(b),console.log("match li: "+_),m||(inbound_data[f]=d)}}else if(i.closest("div").children("label").length>0){var v=i.closest("div").children("label").html()||"NULL";if(v.toLowerCase().indexOf(_)>-1){var p=e.LeadsAPI.inbound_map_fields(i,_,o);e.LeadsAPI.add_inbound_form_class(i,_),console.log("match div: "+_),m||(inbound_data[f]=d)}}else if(i.closest("p").children("label").length>0){var h=i.closest("p").children("label").html()||"NULL";if(h.toLowerCase().indexOf(_)>-1){var p=e.LeadsAPI.inbound_map_fields(i,_,o);e.LeadsAPI.add_inbound_form_class(i,_),console.log("match p: "+_),m||(inbound_data[f]=d)}}else console.log("Need additional mapping data")}return n=p,inbound_data},add_inbound_form_class:function(e,t){var t=t.replace(" ","_"),t=t.replace("-","_");e.addClass("inbound_map_value"),e.attr("data-inbound-form-map","inbound_map_"+t)},inbound_form_type:function(e){var t=t||{},a="normal";if(e.is(".wpl-comment-form"))t.form_type="comment",a="comment";else if(e.is(".wpl-search-box")){a="search",t.form_type="search"}else if(e.is(".wpl-track-me-link")){var n=readCookie("wp_lead_email");console.log(n),t.form_type="link",a="search"}return a},grab_all_form_input_vals:function(t){var a=a||{},n=n||[],o=t.find("input,textarea,select");n.push("inbound_furl","inbound_current_page_url","inbound_notify","inbound_submitted","post_type","post_status","s","inbound_form_name","inbound_form_id","inbound_form_lists");var i=e.LeadsAPI.inbound_form_type(t),l=l||{},s=l.email||!1;o.each(function(){var e=jQuery(this),t=e.attr("type"),o=e.val();"checkbox"===t&&(input_checked=e.attr("checked"),console.log(o),console.log(input_checked),console.log(a[this.name]),"checked"===input_checked&&("undefined"!=typeof a[this.name]?(a[this.name]=a[this.name]+","+o,console.log(a[this.name])):a[this.name]=o)),-1===jQuery.inArray(this.name,n)&&"checkbox"!=t&&(a[this.name]=o),this.value.indexOf("@")>-1&&!s&&(s=o,l.email=s),"search"===i&&(l.search_keyword=o.replace('"',"'"))});var r=JSON.stringify(a);return r},return_mapped_values:function(t){return jQuery(t).find('input[type!="hidden"],textarea,select').each(function(){console.log("run");var t=jQuery(this),a=t.val();if("undefined"!=typeof a&&null!=a&&""!=a)var n=e.LeadsAPI.run_field_map_function(t,"name, first name, last name, email, e-mail, phone, website, job title, company, tele, address, comment");return n}),inbound_data},inbound_form_submit:function(t){var a=inbound_data||{},n=jQuery.totalStorage("page_views");a.page_view_count=e.Utils.countProperties(n),a.leads_list=jQuery(t).find("#inbound_form_lists").val(),a.source=jQuery.cookie("wp_lead_referral_site")||"NA",a.page_id=inbound_ajax.post_id,a.page_views=JSON.stringify(n);var o=e.LeadsAPI.return_mapped_values(t),a=e.Utils.mergeObjs(a,o),t=jQuery(t);if(a.email=a.email?a.email:t.find(".inbound-email").val(),a.form_name=t.find(".inbound_form_name").val()||"Not Found",a.form_id=t.find(".inbound_form_id").val()||"Not Found",a.first_name=a.first_name?a.first_name:a.name,a.last_name=a.last_name||"",a.phone=a.phone||"",a.company=a.company||"",a.address=a.address||"",a.name=a.first_name&&a.last_name?a.first_name+" "+a.last_name:a.name,!a.last_name&&a.first_name){var i=a.first_name.split(" ");a.first_name=i[0],a.last_name=i[1]}var l=e.LeadsAPI.grab_all_form_input_vals(t);if(a.email&&e.Utils.createCookie("wp_lead_email",a.email,365),"undefined"!=typeof landing_path_info)var s=landing_path_info.variation;else if("undefined"!=typeof cta_path_info)var s=cta_path_info.variation;else var s=0;a.variation=s,a.post_type=inbound_ajax.post_type,a.wp_lead_uid=jQuery.cookie("wp_lead_uid")||null,a.ip_address=inbound_ajax.ip_address,a.search_data=JSON.stringify(jQuery.totalStorage("inbound_search"))||{};var r="landing-page"===inbound_ajax.post_type?"Landing Page":"",d="wp-call-to-action"===inbound_ajax.post_type?"Call to Action":"",u=(d||r?r+d:inbound_ajax.post_type,JSON.stringify(a)),c={},c={action:"inbound_store_lead",emailTo:a.email,first_name:a.first_name,last_name:a.last_name,phone:a.phone,address:a.address,company_name:a.company,page_views:a.page_views,form_input_values:l,Mapped_Data:u,Search_Data:a.search_data};return c},formSubmit:function(t){t.preventDefault(),console.log("This works");var a=e.LeadsAPI.inbound_form_submit(t.target,t);console.log(a),alert("Working"),e.LeadsAPI.makeRequest("test.html")},alertContents:function(){4===t.readyState&&(200===t.status?alert(t.responseText):400==xmlhttp.status?alert("There was an error 400"):alert("There was a problem with the request."))},getAllLeadData:function(t){var a=e.Utils.readCookie("wp_lead_id"),n=jQuery.totalStorage("inbound_lead_data"),o={action:"inbound_get_all_lead_data",wp_lead_id:a},i=function(e){var t=JSON.parse(e);console.log("RAAAAAAn"),setGlobalLeadVar(t),jQuery.totalStorage("inbound_lead_data",t)};if(n||console.log("No old data"),"true"===t&&console.log("Session has not expired"),n||null!==t){setGlobalLeadVar(n);var l=e.Utils.readCookie("lead_data_expiration");null===l&&(e.Utils.doAjax(o,i),console.log("localized data old. Pull new from DB"))}else e.debug("Go to Database",function(){console.log(t),console.log(n)}),e.Utils.doAjax(o,i)},getLeadLists:function(){var t=e.Utils.readCookie("wp_lead_id"),a={action:"wpl_check_lists",wp_lead_id:t},n=function(){jQuery.cookie("lead_session_list_check",!0,{path:"/",expires:1}),console.log("Lists checked")};e.Utils.doAjax(a,n)}},e}(InboundAnalytics||{}),InboundAnalyticsPageTracking=function(e){return e.PageTracking={getPageViews:function(){var t=e.Utils.checkLocalStorage();if(t){var a=localStorage.getItem("page_views"),n=JSON.parse(a);return"object"==typeof n&&n&&this.StorePageView(),n}},StorePageView:function(){var t=this.CheckTimeOut(),a=jQuery.totalStorage("page_views");null===a&&(a={});var n=wplft.post_id,o=e.Utils.GetDate();if(t){var i=a[n];if("undefined"!=typeof i&&null!==i){a[n].push(o);var l=a[n].length;e.Events.pageRevisit(l)}else{a[n]=[],a[n].push(o);var l=1;e.Events.pageFirstView(l)}jQuery.totalStorage("page_views",a)}},CheckTimeOut:function(){var t=jQuery.totalStorage("page_views");if(null===t)var t={};var a=wplft.post_id,n=!0,o=t[a];if("undefined"!=typeof o&&null!==o){var i=e.Utils.GetDate(),l=t[a].length-1,s=t[a][l],r=new Date(s).getTime(),d=new Date(i).getTime(),u=Math.abs(r-d),c=3e4;if(e.debug("Timeout Checks =",function(){console.log("Current Time is: "+i),console.log("Last view is: "+s),console.log("Last view milliseconds "+r),console.log("time now milliseconds "+d),console.log("Wait Check: "+c),console.log("TIME CHECK: "+u)}),c>u){time_left=.001*Math.abs(c-u),n=!1;var _="30 sec timeout not done: "+time_left+" seconds left"}else{var _="Timeout Happened. Page view fired";this.firePageView(),n=!0,e.Events.analyticsTriggered()}console.log(_)}else this.firePageView();return n},firePageView:function(){var t=e.Utils.readCookie("wp_lead_id"),a=e.Utils.readCookie("wp_lead_uid");if("undefined"!=typeof t&&null!=t&&""!=t){e.debug("Run page view ajax");var n={action:"wpl_track_user",wp_lead_uid:a,wp_lead_id:t,page_id:wplft.post_id,current_url:window.location.href,json:"0"},o=function(){e.Events.analyticsSaved()};e.Utils.doAjax(n,o)}},tabSwitch:function(){var t,a,n;"undefined"!=typeof document.hidden?(t="hidden",n="visibilitychange",a="visibilityState"):"undefined"!=typeof document.mozHidden?(t="mozHidden",n="mozvisibilitychange",a="mozVisibilityState"):"undefined"!=typeof document.msHidden?(t="msHidden",n="msvisibilitychange",a="msVisibilityState"):"undefined"!=typeof document.webkitHidden&&(t="webkitHidden",n="webkitvisibilitychange",a="webkitVisibilityState");var o=document[t];document.addEventListener(n,function(){o!=document[t]&&(document[t]?(console.log("hidden"),e.Events.browserTabHidden()):(console.log("shown"),e.Events.browserTabVisible()),o=document[t])})}},e}(InboundAnalytics||{}),Lead_Globals=jQuery.totalStorage("inbound_lead_data")||null;InboundAnalytics.init(),jQuery(document).ready(function(){var e=InboundAnalytics.Utils,t=(e.readCookie("wp_lead_uid"),e.readCookie("wp_lead_id")),a=e.readCookie("lead_session_expire");null===a&&(console.log("expired vistor. Run Processes"),"undefined"!=typeof t&&null!=t&&""!=t&&(InboundAnalytics.LeadsAPI.getAllLeadData(a),InboundAnalytics.LeadsAPI.getLeadLists())),e.contentLoaded(window,InboundAnalytics.LeadsAPI.attachFormSubmitEvent),e.SetSessionTimeout()});